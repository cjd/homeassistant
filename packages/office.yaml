light:
  - platform: group
    name: Office Lights
    entities:
      - light.office_light_light

switch:
  - platform: template
    switches:
      office_lights:
        value_template: "{{ states('light.office_lights') }}"
        icon_template: mdi:desktop-classic
        friendly_name: "Office"
        turn_on:
          - service: light.turn_on
            data:
              entity_id: light.office_lights
              brightness_pct: 100
              transition: 1
          - service: light.turn_on
            data:
              entity_id: light.office_lights
        turn_off:
          service: light.turn_off
          data:
              entity_id: light.office_lights
              transition: 1

climate:
  - platform: generic_thermostat
    name: Office
    heater: switch.koganpow1
    target_sensor: sensor.office_temperature
    initial_hvac_mode: "off"

fan:
  - platform: mqtt
    name: "Office Fan"
    command_topic: "Office_Fan/cmnd/FanSpeed"
    speed_command_topic: "Office_Fan/cmnd/FanSpeed"
    state_topic: "Office_Fan/stat/RESULT"
    speed_state_topic: "Office_Fan/stat/RESULT"
    state_value_template: >
      {% if value_json.FanSpeed is defined %}
        {% if value_json.FanSpeed == 0 -%}0{%- elif value_json.FanSpeed > 0 -%}4{%- endif %}
      {% else %}
        {% if states.fan.Office_Fan.state == 'off' -%}0{%- elif states.fan.Office_Fan.state == 'on' -%}4{%- endif %}
      {% endif %}
    speed_value_template: "{{ value_json.FanSpeed }}"
    availability_topic: Office_Fan/tele/LWT
    payload_off: "0"
    payload_on: "4"
    payload_low_speed: "1"
    payload_medium_speed: "2"
    payload_high_speed: "3"
    payload_available: Online
    payload_not_available: Offline
    speeds:
      - off
      - low
      - medium
      - high

automation:
  - alias: Office - Switch 1
    trigger:
      - entity_id: binary_sensor.office_switch1
        platform: state
        to: "on"
    condition: []
    action:
      - entity_id: light.office_lights
        service: light.turn_on
        data:
          transition: 1
          brightness_pct: 100
      - entity_id: switch.powerboard_outlet_1
        service: switch.turn_on
  - alias: Office - Switch 2
    trigger:
      - entity_id: binary_sensor.office_switch2
        platform: state
        to: "on"
    condition: []
    action:
      - entity_id: light.office_lights
        service: light.turn_on
        data:
          transition: 1
          brightness_pct: 50
      - entity_id: switch.powerboard_outlet_1
        service: switch.turn_on
  - alias: Office - Switch 3
    trigger:
      - entity_id: binary_sensor.office_switch3
        platform: state
        to: "on"
    condition: []
    action:
      - entity_id: light.office_lights
        service: light.turn_off
      - entity_id: switch.powerboard_outlet_1
        service: switch.turn_off
  - alias: Office - Dimmer
    id: office_light
    trigger:
    - entity_id: sensor.office_dimmer_action
      platform: state
    condition:
      - condition: template
        value_template: "{{ trigger.to_state.state in ['on-press', 'up-press', 'down-press', 'off-press'] }}"
    action:
    - entity_id: switch.powerboard_outlet_1
      service_template: >
          {% if trigger.to_state.state == 'on-press' %}switch.turn_on
          {% elif trigger.to_state.state == 'up-press' %}switch.turn_on
          {% elif trigger.to_state.state == 'down-press' %}switch.turn_off
          {% elif trigger.to_state.state == 'off-press' %}switch.turn_off
          {% endif %}
    - entity_id: light.office_lights
      service: light.turn_on
      data_template:
        transition: 1
        brightness_pct: >
          {% if trigger.to_state.state == 'on-press' %}100
          {% elif trigger.to_state.state == 'up-press' %} 50
          {% elif trigger.to_state.state == 'down-press' %}1
          {% elif trigger.to_state.state == 'off-press' %}0
          {% endif %}
