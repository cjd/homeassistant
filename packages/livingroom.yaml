light:
  - platform: group
    name: Livingroom Lights
    entities:
      - light.livingroomside
      - light.livingrooma
      - light.livingroomb

switch:
  - platform: template
    switches:
      livingroom_lights:
        icon_template: mdi:sofa
        friendly_name: "Livingroom"
        value_template: "{{ not is_state('input_select.livingroom_preset', 'TurnOff') }}"
        turn_on:
          service: input_select.select_option
          data:
            entity_id: input_select.livingroom_preset
            option: "Normal"
        turn_off:
          service: input_select.select_option
          data:
            entity_id: input_select.livingroom_preset
            option: "TurnOff"

climate:
  - platform: sensibo
    api_key: !secret sensibo_api_key

camera:
  - platform: generic
    name: livingroom
    stream_source: rtsp://192.168.86.56:554/
    still_image_url: https://home.adebenham.com/int/motion/picture/4/current/


automation:
  - id: day
    alias: Livingroom - Time - Day
    trigger:
    - event: sunrise
      platform: sun
    condition: []
    action:
    - data:
        effect: Slow Random Effect
        entity_id: light.family_room_strip
      entity_id: light.family_room_strip
      service: light.turn_on
  - id: night
    alias: Livingroom - Time - Night
    trigger:
    - event: sunset
      platform: sun
    condition: []
    action:
    - data:
        effect: Rainbow
        entity_id: light.family_room_strip
      entity_id: light.family_room_strip
      service: light.turn_on
  - alias: Livingroom - Preset selected
    trigger:
      platform: state
      entity_id: input_select.livingroom_preset
    action:
      service_template: >
        {% if trigger.to_state.state|length %}scene.turn_on
        {% else %}script.noop
        {% endif %}
      data_template:
        entity_id: >
          {% if trigger.to_state.state == "Normal" %}scene.normal
          {% elif trigger.to_state.state == "Night" %}scene.night
          {% elif trigger.to_state.state == "Party" %}scene.party
          {% elif trigger.to_state.state == "TurnOff" %}scene.turn_off
          {% endif %}
  - alias: Livingroom - Preset manual off
    trigger:
      - entity_id: light.livingroom_lights
        platform: state
        to: "off"
        for: "00:00:05"
    condition:
      - condition: template
        value_template: '{{ not is_state("input_select.livingroom_preset", "TurnOff") }}'
    action:
      - entity_id: input_select.livingroom_preset
        service: input_select.select_option
        data:
          option: "TurnOff"
  # - alias: Livingroom - Preset manual on
  #   trigger:
  #     - entity_id: light.livingroom_lights
  #       platform: state
  #       to: "on"
  #       for: "00:00:05"
  #   condition:
  #     - condition: template
  #       value_template: '{{ is_state("input_select.livingroom_preset", "TurnOff") }}'
  #   action:
  #     - entity_id: input_select.livingroom_preset
  #       service: input_select.select_option
  #       data:
  #         option: "Normal"
  - alias: Livingroom - Switch 1
    trigger:
      - entity_id: binary_sensor.livingroom_switch1
        platform: state
        to: "on"
    condition: []
    action:
      - entity_id: input_select.livingroom_preset
        service: input_select.select_option
        data:
          option: "Normal"
  - alias: Livingroom - Switch 2
    trigger:
      - entity_id: binary_sensor.livingroom_switch2
        platform: state
        to: "on"
    condition: []
    action:
      - entity_id: input_select.livingroom_preset
        service: input_select.select_option
        data:
          option: "Night"
  - alias: Livingroom - Switch 2 - longpress
    trigger:
      - entity_id: binary_sensor.livingroom_switch2
        platform: state
        to: "on"
        for: "00:00:05"
    condition: []
    action:
      - entity_id: input_select.livingroom_preset
        service: input_select.select_option
        data:
          option: "Party"
  - alias: Livingroom - Switch 3
    trigger:
      - entity_id: binary_sensor.livingroom_switch3
        platform: state
        to: "on"
    condition: []
    action:
      - entity_id: input_select.livingroom_preset
        service: input_select.select_option
        data:
          option: "TurnOff"
  - alias: Livingroom - AC State set
    trigger:
      - entity_id: binary_sensor.ac_active_sensor_contact
        platform: state 
        to: "off"
        for: "00:01:00"
    condition: []
    action:
      - entity_id: climate.living_room
        service: climate.turn_off
  - alias: Livingroom - AC on but doors/windows left open
    trigger:
      - entity_id: binary_sensor.backdoor_sensor_contact
        platform: state
        to: 'on'
        for: "00:00:30"
      - entity_id: binary_sensor.frontdoor_contact
        platform: state
        to: 'on'
        for: "00:00:30"
      - entity_id: binary_sensor.livingroom_window_sensor_contact
        platform: state
        to: 'on'
        for: "00:00:30"
    condition:
      - condition: state
        entity_id: binary_sensor.ac_active_sensor_contact
        state: 'on'
    action:
      - service: notify.hangout_notify
        data:
          message: "Door/window left open but AC is on"
  - alias: Livingroom - AC on but doors/windows already open
    trigger:
      - entity_id: binary_sensor.ac_active_sensor_contact
        platform: state
        to: 'on'
        for: "00:00:30"
    condition:
      condition: or
      conditions:
        - condition: state
          entity_id: binary_sensor.backdoor_sensor_contact
          state: 'on'
        - condition: state
          entity_id: binary_sensor.frontdoor_contact
          state: 'on'
        - condition: state
          entity_id: binary_sensor.livingroom_window_sensor_contact
          state: 'on'
    action:
      - service: notify.hangout_notify
        data:
          message: "AC turned on but door/window open"
  - alias: Livingroom - AC State Heat
    trigger:
      - entity_id: climate.living_room
        platform: state
        to: 'heat'
    action:
      - entity_id: input_select.livingroom_ac_state
        service: input_select.select_option
        data:
          option: "Heat"
  - alias: Livingroom - AC State Off
    trigger:
      - entity_id: climate.living_room
        platform: state
        to: 'off'
    action:
      - entity_id: input_select.livingroom_ac_state
        service: input_select.select_option
        data:
          option: "Off"
  - alias: Livingroom - AC State Fan
    trigger:
      - entity_id: climate.living_room
        platform: state
        to: 'fan_only'
    action:
      - entity_id: input_select.livingroom_ac_state
        service: input_select.select_option
        data:
          option: "Fan"
  - alias: Livingroom - AC State Dry
    trigger:
      - entity_id: climate.living_room
        platform: state
        to: 'dry'
    action:
      - entity_id: input_select.livingroom_ac_state
        service: input_select.select_option
        data:
          option: "Dry"
  - alias: Livingroom - AC State Auto
    trigger:
      - entity_id: climate.living_room
        platform: state
        to: 'heat_cool'
    action:
      - entity_id: input_select.livingroom_ac_state
        service: input_select.select_option
        data:
          option: "Auto"
  - alias: Livingroom - AC State Cool
    trigger:
      - entity_id: climate.living_room
        platform: state
        to: 'cool'
    action:
      - entity_id: input_select.livingroom_ac_state
        service: input_select.select_option
        data:
          option: "Cool"


scene:
  - name: Normal
    entities:
      light.livingroom_lights:
        state: true
        effect: 0
        brightness_pct: 100
        color_temp: 420
      light.kitchen_lights:
        effect: 0
        brightness_pct: 100
        color_temp: 420
        state: true
      light.kitchen_strip:
        brightness_pct: 100
        color_name: white
        effect: None
        state: true
      light.tv_backlight:
        state: true
        brightness_pct: 100
        effect: Slow Random Effect
      switch.livingroom_relay_1:
        state: true
      switch.kitchen_relay_2:
        state: true
  - name: Night
    entities:
      light.kitchen_lights:
        state: true
        effect: 0
        rgb_color: [0,0,155]
        brightness_pct: 100
      light.kitchen_strip:
        state: true
        effect: None
        rgb_color: [0,0,155]
        brightness_pct: 100
      light.livingroom_lights:
        state: true
        effect: 0
        rgb_color: [0,0,155]
        brightness_pct: 100
      light.backroom_lights:
        rgb_color: [0,0,155]
        effect: 0
        brightness_pct: 100
        state: true
      light.tv_backlight:
        state: true
        brightness_pct: 100
        effect: Random Twinkle
      switch.livingroom_relay_1:
        state: true
      switch.kitchen_relay_1:
        state: true
      switch.kitchen_relay_2:
        state: true
  - name: Party
    entities:
      light.kitchen_lights:
        state: true
        effect: 2
        rgb_color: [0,0,155]
        brightness_pct: 100
      light.kitchen_strip:
        state: true
        effect: Rainbow
        brightness_pct: 100
      light.livingroom_lights:
        state: true
        effect: 2
        rgb_color: [0,0,155]
        brightness_pct: 100
      light.backroom_lights:
        state: true
        effect: 2
        rgb_color: [0,0,155]
        brightness_pct: 100
      light.tv_backlight:
        state: true
        brightness_pct: 100
        effect: Rainbow
      switch.livingroom_relay_1:
        state: true
      switch.kitchen_relay_1:
        state: true
      switch.kitchen_relay_2:
        state: true
  - name: Turn off
    entities:
      light.kitchen_lights: false
      light.kitchen_strip: false
      light.livingroom_lights: false
      light.backroom_lights: false
      light.tv_backlight:
        state: true
        brightness_pct: 100
        effect: Random Twinkle